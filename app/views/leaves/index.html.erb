<div class="row">
  <div class="large-12 columns">
    <h1><%= current_organization.name.capitalize %>'s <%= t :employees_leaves %></h1>
  </div>
</div>

<dl class="tabs" data-tab>
  <dd class="active"><a href="#panel1a"><%= t :pending_leaves %></a></dd>
  <dd><a href="#panel2a"><%= t :waiting_for_verification_leaves %></a></dd>
  <dd><a href="#panel3a"><%= t :history %></a></dd>
  <dd><a href="#panel4a"><%= t :leave_calendar %></a></dd>
</dl>
<div class="tabs-content">
  <div class="content active" id="panel1a">
    <table>
      <thead>
        <th><%= t :name %></th>
        <th><%= t :start_date %> </th>
        <th><%= t :duration %></th>
        <th><%= t :comment %></th>
        <th><%= t :leave_type %></th>
        <th><%= t :action %></th>
      </thead>
      <% @pending_leaves.each do |leave|%>
        <tr>
          <td><%= leave.employee.name_with_initial %></td>
          <td><%= leave.start_date.to_date.strftime("%d/%m/%Y") %></td>
          <td><%= leave.duration_seconds/24/60/60%> Days</td>
          <td><%= leave.comment %></td>
          <td><%= leave.leave_type.name%></td>
          <td>
          <a href="#" data-dropdown="drop_<%=leave.id %>" class="tiny button dropdown"><%= t :details %></a>
            <ul id="drop_<%=leave.id %>" data-dropdown-content class="f-dropdown">
              <li>
                <%= link_to t(:approve), organization_leave_path(current_organization, leave, leave: {status: "Approved"}), method: "patch", class: "fi-check", id: "approve_leave"%>
              </li>
              <li>
                <%= link_to t(:reject), organization_leave_path(current_organization, leave, leave: {status: "Rejected"}), method: "patch", class: "fi-x", id: "reject_leave"%>
              </li>
            </ul>
          </td>
        </tr>
      <% end %>
    </table>
  </div>
  <div class="content" id="panel2a">
    <table>
      <thead>
        <th><%= t :name %></th>
        <th><%= t :start_date %></th>
        <th><%= t :duration %></th>
        <th><%= t :comment %></th>
        <th><%= t :leave_type %></th>
        <th><%= t :action %></th>
      </thead>
      <% @verification_needed_leaves.each do |leave|%>
        <tr>
          <td><%= leave.employee.name_with_initial %></td>
          <td><%= leave.start_date.to_date.strftime("%d/%m/%Y") %></td>
          <td><%= leave.duration_seconds/24/60/60%> Days</td>
          <td><%= leave.comment %></td>
          <td><%= leave.leave_type.name %></td>
          <td>
            <a href="#" data-dropdown="drop_<%= leave.id %>" class="tiny button dropdown"><%= t :details %></a>
            <ul id="drop_<%= leave.id %>" data-dropdown-content class="f-dropdown">
              <li>
                <%= link_to t(:verify), organization_leave_path(current_organization, leave, leave: {status: "Approved"}), method: "patch", class: "fi-check" %>
              </li>
              <li>
                <%= link_to t(:reject), organization_leave_path(current_organization, leave, leave: {status: "Rejected"}), method: "patch", class: "fi-x" %>
              </li>
            </ul>
          </td>
        </tr>
      <% end %>
    </table>
  </div>
  <div class="content" id="panel3a">
    <div class="large-12 columns">
      <table>
        <thead>
          <th><%= sort_link @search, :last_name, t(:name) %></th>
          <th><%= t :type %></th>
          <th><%= sort_link @search, :comment, t(:comment) %></th>
          <th><%= sort_link @search, :duration_seconds, t(:duration) %></th>
          <th><%= sort_link @search, :date, t(:when) %></th>
          <th><%= sort_link @search, :status, t(:status) %></th>
          <th><%= t :action_by %></th>
        </thead>
        <tbody>
        <% @leaves.each do |history|%>
        <tr>
          <td><%= history.employee.name_with_initial %></td>
          <td><%= history.leave_type.name %></td>
          <td><%= history.comment %></td>
          <td><%= (history.duration_seconds)/60/60/24 %> Days</td>
          <td><%= history.start_date.to_date.strftime("%d/%m/%Y") %> - <%= (history.start_date.to_date + ((history.duration_seconds)/60/60/24-1).days).strftime("%d/%m/%Y") %></td>
          <td><%= history.status %></td>
          <td><%= history.action_by.nil? ? t(:no_action_yet) : (link_to history.action_by.profile.last_name, organization_employee_path(current_organization, history.action_by.profile)) %></td>
        </tr>
        <%end%>
        </tbody>
      </table>
      <%= paginate @leaves %>
      <a href="#" data-dropdown="end_of_year" class="tiny button dropdown"><%= t :end_of_year%></a>
      <ul id="end_of_year" data-dropdown-content class="f-dropdown">
        <li><%= link_to t(:reset_employees_available_leaves), organization_end_of_year_action_path(forfeit: true), method: :post%></li>
        <li><%= link_to t(:carry_forward_employees_available_leaves), organization_end_of_year_action_path(forward: true), method: :post%></li>
      </ul>
    </div>
  </div>
  <div class="content" id="panel4a">
    <%= render "select_year_month" %>
    <% if current_organization.organization_setting.nil? %>
      <%= render "without_setting"%>
    <% else %>
      <%= render "with_setting" %>
    <% end %>
  </div>
</div>

